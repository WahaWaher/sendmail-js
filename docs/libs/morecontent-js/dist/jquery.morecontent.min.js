/**
 * jQuery.moreContent
 * Version: 1.0.0
 * Repo: https://github.com/WahaWaher/morecontent-js
 * Author: Sergey Kravchenko
 * Contacts: wahawaher@gmail.com
 * License: MIT
 */

!function(r){var a,i={height:175,useCss:!0,speed:250,open:!1,event:"click",shadow:!1,easing:"swing",textClose:"Читать полностью",textOpen:"Свернуть",tpl:{content:'<div class="mrc-content"></div>',contentWrap:'<div class="mrc-content-wrap"></div>',btn:'<button class="mrc-btn" type="button"></button>',btnWrap:'<div class="mrc-btn-wrap"></div>',controls:'<div class="mrc-controls"></div>',shadow:'<div class="mrc-shadow"></div>'}},l=function(t,e){this.$self=t,this.init(e)},t=l.prototype;t.init=function(t){var e,n=this,s=n.$self,o=r(s);!0!==n.inited&&(n.defaults=r.extend(!0,{},i,r.fn.moreContent.defaults),n.options=t||{},n.dataOptions=r(s).data("mrc")||{},n.settings=sets=r.extend(!0,{},n.defaults,n.options,n.dataOptions),n.src={html:o.html()||"",class:o.attr("class")||"",style:o.attr("style")||""},n.nsid=a.getRndNum(1e4,99999),n.status=sets.open,n.dropped=!1,n.manually=!1,n.createMarkup(),n.getCurMode(),n.layout.btn.on(sets.event,function(){n.toggle.call(n)}),e=a.debounce(function(){n.getAdaptive.call(n)},150),r(window).on("resize.mrc-"+n.nsid,e),o.trigger("beforeInitSwitch.mrc",[n,sets]),n.status?n.open(!0):n.close(!0),setTimeout(function(){n.inited=!0,o.trigger("afterInit.mrc",[n,sets])},sets.speed+5))},t.createMarkup=function(){var t,e=this,n=e.$self,s=e.settings,o=e.layout={};o.self=r(n).addClass("mrc"),o.self.wrapInner(s.tpl.content),o.content=o.self.children().css("overflow","hidden"),o.content.wrapInner(s.tpl.contentWrap),o.contentWrap=o.content.children().css("overflow","hidden"),o.controls=r(s.tpl.controls).appendTo(o.self),o.btn=r(s.tpl.btn).text(s.textClose).insertAfter(o.controls).wrap(r(s.tpl.btnWrap)).hide().fadeIn(s.speed),o.btnWrap=o.btn.parent().appendTo(o.controls),s.shadow&&(o.content.css("position","relative"),o.shadow=r(s.tpl.shadow).appendTo(o.content)),s.useCss&&(t=parseInt(getComputedStyle(n).maxHeight)),o.self.css({"max-height":"none","min-height":"none"}),t&&0<t&&(e.setContent(t),s.height=t)},t.open=function(t){var e=this,n=e.settings,s=e.layout;e.status&&!t||(e.mode||s.btnWrap.hide(),s.btn.text(n.textOpen),n.shadow&&s.shadow.fadeOut(n.speed),s.self.trigger("beforeOpen.mrc",[e,n,s.content,e.fullHeight+"px"]),e.manually||s.content.animate({height:e.fullHeight+"px"},e.mode?n.speed:0,n.easing,function(){e.afterChange("open")}),e.manually=!1,e.status=!0)},t.close=function(t){var e=this,n=e.settings,s=e.layout;(e.status||t||e.dropped)&&(!e.mode&&n.useCss&&e.setContent(),e.mode||s.btnWrap.hide(),s.btn.text(n.textClose),n.shadow&&(e.mode?s.shadow.fadeIn(n.speed):s.shadow.fadeOut(n.speed)),s.self.trigger("beforeClose.mrc",[e,n,s.content,(e.mode?n.height:"")+"px"]),e.manually||s.content.animate({height:(e.mode?n.height:"")+"px"},n.speed,n.easing,function(){e.afterChange("close")}),e.manually=!1,e.dropped=!1,e.status=!1)},t.drop=function(t,e){var n=this,s=n.layout;t=t||100,e=e||"px";if(n.getCurMode(),n.curHeight>=n.fullHeight||!n.mode)return!1;var o="%"==e?Math.ceil(t*n.fullHeight/100):t;pxPush=n.curHeight+o,pxPush>=n.fullHeight?(o=n.fullHeight-n.curHeight,pxPush=n.curHeight+o,s.btn.text(sets.textOpen),sets.shadow&&s.shadow.fadeOut(sets.speed),n.status&&n.setContent(),s.self.addClass("open"),n.dropped=!1,n.status=!0):n.dropped=Math.ceil(n.curHeight/(n.fullHeight/100)),n.curHeight=pxPush,s.self.trigger("beforeDrop.mrc",[n,sets,s.content,pxPush+"px"]),n.manually||s.content.animate({height:pxPush+"px"},sets.speed,sets.easing,function(){n.afterChange("drop")})},t.toggle=function(){var t=this;t.status?t.close(!0):t.open(!0)},t.afterChange=function(t){var e=this,n=e.settings,s=e.layout;switch(e.calcSizes(),t){case"open":e.setContent(),s.self.addClass("open"),s.self.trigger("afterOpen.mrc",[e,n,s.content]);break;case"close":s.self.removeClass("open"),s.self.trigger("afterClose.mrc",[e,n,s.content]);break;case"drop":e.status&&e.setContent(),e.curHeight>=e.fullHeight?s.self.removeClass("dropped"):s.self.addClass("dropped"),s.self.trigger("afterDrop.mrc",[e,n,s.content]);break;default:return}s.self.trigger("onChange.mrc",[e,n])},t.setContent=function(t){this.layout.content.css("height",t||"")},t.calcSizes=function(){var t=this,e=(t.settings,t.layout);t.curHeight=e.content.get(0).clientHeight||0,t.fullHeight=e.contentWrap.get(0).clientHeight||0},t.getCurMode=function(){var t=this,e=t.settings.height;t.calcSizes(),t.fullHeight>=e&&1!=t.mode?t.mode=!0:t.fullHeight<e&&0!=t.mode&&(t.mode=!1)},t.getAdaptive=function(){var t,e=this,n=e.settings,s=e.layout;e.getCurMode(),e.mode?(e.dropped&&((t=e.dropped*(e.fullHeight/100))<n.height&&(t=n.height),s.content.animate({height:t+"px"},250)),s.btnWrap.fadeIn(n.speed),e.status?e.setContent():(e.setContent(e.curHeight),n.shadow&&s.shadow.fadeIn(n.speed))):(s.btnWrap.hide(),e.setContent(),n.shadow&&s.shadow.fadeOut(n.speed)),s.self.trigger("onChange.mrc",[e,n])},t.destroy=function(){var t=this,e=t.$self,n=(t.settings,t.layout);t.inited&&(r(window).off("resize.mrc-"+t.nsid),n.self.attr({class:t.src.class,style:t.src.style}).html(t.src.html),n.content.remove(),n.controls.remove(),delete e.MoreContent)},t.reinit=function(t){var e=this,n=e.$self,s="object"==typeof t&&0!=Object.keys(t).length?t:r.extend(!0,{},e.settings);e.destroy(),r(n).moreContent(s)},a={getRndNum:function(t,e){return Math.round(t-.5+Math.random()*(e-t+1))},debounce:function(s,o){var a;return function(){var t=this,e=arguments,n=!a;clearTimeout(a),a=setTimeout(function(){a=null,s.apply(t,e)},o),n&&s.apply(t,e)}}},r.fn.moreContent=function(){var s="MoreContent",n=arguments,o=n[0];function a(t,e,n){if(t[s]instanceof l&&e in t[s])return t[s][e].apply(t[s],Array.prototype.slice.call(n,1))}function i(t,e){if(!(t[s]instanceof l))return new l(t,e)}return r.each(this,function(t,e){"object"==typeof o||void 0===o?e[s]=i(e,o):"init"===o||"reinit"===o?e[s]?a(e,o,n):e[s]=i(e,n[1]):a(e,o,n)}),this},r.fn.moreContent.prototype=l.prototype,r.fn.moreContent.defaults=i}(jQuery);