/**
 * jQuery.moreContent Lite
 * Version: 1.0.0
 * Repo: https://github.com/WahaWaher/morecontent-js
 * Author: Sergey Kravchenko
 * Contacts: wahawaher@gmail.com
 * License: MIT
 */

!function(c){var a,i={height:175,useCss:!0,speed:250,open:!1,event:"click",shadow:!1,easing:"swing",textClose:"Читать полностью",textOpen:"Свернуть",tpl:{content:'<div class="mrc-content"></div>',contentWrap:'<div class="mrc-content-wrap"></div>',btn:'<button class="mrc-btn" type="button"></button>',btnWrap:'<div class="mrc-btn-wrap"></div>',controls:'<div class="mrc-controls"></div>',shadow:'<div class="mrc-shadow"></div>'}},d=function(t,e){this.$self=t,this.init(e)},t=d.prototype;t.init=function(t){var e,n=this,s=n.$self,o=c(s);!0!==n.inited&&(n.defaults=c.extend(!0,{},i,c.fn.moreContent.defaults),n.options=t||{},n.dataOptions=c(s).data("mrc")||{},n.settings=sets=c.extend(!0,{},n.defaults,n.options,n.dataOptions),n.src={html:o.html()||"",class:o.attr("class")||"",style:o.attr("style")||""},n.nsid=a.getRndNum(1e4,99999),n.status=sets.open,n.createMarkup(),n.getCurMode(),n.layout.btn.on(sets.event,function(){n.toggle.call(n)}),e=a.debounce(function(){n.getAdaptive.call(n)},150),c(window).on("resize.mrc-"+n.nsid,e),n.status?n.open(!0):n.close(!0),setTimeout(function(){n.inited=!0},sets.speed+5))},t.createMarkup=function(){var t,e=this,n=e.$self,s=e.settings,o=e.layout={};o.self=c(n).addClass("mrc"),o.self.wrapInner(s.tpl.content),o.content=o.self.children().css("overflow","hidden"),o.content.wrapInner(s.tpl.contentWrap),o.contentWrap=o.content.children().css("overflow","hidden"),o.controls=c(s.tpl.controls).appendTo(o.self),o.btn=c(s.tpl.btn).text(s.textClose).insertAfter(o.controls).wrap(c(s.tpl.btnWrap)).hide().fadeIn(s.speed),o.btnWrap=o.btn.parent().appendTo(o.controls),s.shadow&&(o.content.css("position","relative"),o.shadow=c(s.tpl.shadow).appendTo(o.content)),s.useCss&&(t=parseInt(getComputedStyle(n).maxHeight)),o.self.css({"max-height":"none","min-height":"none"}),t&&0<t&&(e.setContent(t),s.height=t)},t.open=function(t){var e=this,n=e.settings,s=e.layout;e.status&&!t||(e.mode||s.btnWrap.hide(),s.btn.text(n.textOpen),n.shadow&&s.shadow.fadeOut(n.speed),s.content.animate({height:e.fullHeight+"px"},e.mode?n.speed:0,n.easing,function(){e.afterChange("open")}),e.status=!0)},t.close=function(t){var e=this,n=e.settings,s=e.layout;(e.status||t)&&(!e.mode&&n.useCss&&e.setContent(),e.mode||s.btnWrap.hide(),s.btn.text(n.textClose),n.shadow&&(e.mode?s.shadow.fadeIn(n.speed):s.shadow.fadeOut(n.speed)),s.content.animate({height:(e.mode?n.height:"")+"px"},n.speed,n.easing,function(){e.afterChange("close")}),e.status=!1)},t.toggle=function(){var t=this;t.status?t.close(!0):t.open(!0)},t.afterChange=function(t){var e=this,n=(e.settings,e.layout);switch(e.calcSizes(),t){case"open":e.setContent(),n.self.addClass("open");break;case"close":n.self.removeClass("open");break;default:return}},t.setContent=function(t){this.layout.content.css("height",t||"")},t.calcSizes=function(){var t=this,e=(t.settings,t.layout);t.curHeight=e.content.get(0).clientHeight||0,t.fullHeight=e.contentWrap.get(0).clientHeight||0},t.getCurMode=function(){var t=this,e=t.settings.height;t.calcSizes(),t.fullHeight>=e&&1!=t.mode?t.mode=!0:t.fullHeight<e&&0!=t.mode&&(t.mode=!1)},t.getAdaptive=function(){var t=this,e=t.settings,n=t.layout;t.getCurMode(),t.mode?(n.btnWrap.fadeIn(e.speed),t.status?t.setContent():(t.setContent(t.curHeight),e.shadow&&n.shadow.fadeIn(e.speed))):(n.btnWrap.hide(),t.setContent(),e.shadow&&n.shadow.fadeOut(e.speed))},a={getRndNum:function(t,e){return Math.round(t-.5+Math.random()*(e-t+1))},debounce:function(s,o){var a;return function(){var t=this,e=arguments,n=!a;clearTimeout(a),a=setTimeout(function(){a=null,s.apply(t,e)},o),n&&s.apply(t,e)}}},c.fn.moreContent=function(){var s="MoreContent",n=arguments,o=n[0];function a(t,e,n){if(t[s]instanceof d&&e in t[s])return t[s][e].apply(t[s],Array.prototype.slice.call(n,1))}function i(t,e){if(!(t[s]instanceof d))return new d(t,e)}return c.each(this,function(t,e){"object"==typeof o||void 0===o?e[s]=i(e,o):"init"===o?e[s]?a(e,o,n):e[s]=i(e,n[1]):a(e,o,n)}),this},c.fn.moreContent.defaults=i}(jQuery);